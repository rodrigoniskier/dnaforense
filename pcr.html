<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Forense - PCR e Eletroforese (Vers√£o Atualizada)</title>
    
    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Anima√ß√£o dos fragmentos correndo para o laser */
        @keyframes runToLaser {
            0% { left: 5%; opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { left: 85%; opacity: 0; } /* O laser est√° em aprox 75%, eles passam por ele */
        }
        
        .fragment-run {
            position: absolute;
            border-radius: 50%;
            box-shadow: 0 0 5px currentColor;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- DADOS DOS CEN√ÅRIOS ---
        const SCENARIOS = [
            {
                id: 1,
                title: "Cen√°rio 1: Homic√≠dio",
                type: "crime",
                description: "Compara√ß√£o de sangue na cena do crime vs. Suspeito.",
                marker: "D8S1179",
                profiles: [
                    { name: "Evid√™ncia (Cena)", alleles: [13, 15], color: "#ef4444" }, // Vermelho
                    { name: "Suspeito A", alleles: [13, 15], color: "#3b82f6" }       // Azul
                ],
                conclusion: "Inclus√£o (Coincid√™ncia)",
                explanation: "O perfil gen√©tico do Suspeito A apresenta os mesmos alelos (13, 15) que a evid√™ncia. N√£o houve exclus√£o."
            },
            {
                id: 2,
                title: "Cen√°rio 2: Agress√£o Sexual",
                type: "crime",
                description: "Material biol√≥gico da v√≠tima vs. Suspeito B.",
                marker: "vWA",
                profiles: [
                    { name: "Evid√™ncia (Cena)", alleles: [14, 17], color: "#ef4444" },
                    { name: "Suspeito B", alleles: [16, 18], color: "#3b82f6" }
                ],
                conclusion: "Exclus√£o",
                explanation: "O perfil da evid√™ncia (14, 17) √© distinto do Suspeito B (16, 18). O suspeito √© exclu√≠do como doador."
            },
            {
                id: 3,
                title: "Cen√°rio 3: Teste de Paternidade",
                type: "paternity",
                description: "Trio: M√£e, Filho e Suposto Pai.",
                marker: "TH01",
                profiles: [
                    { name: "M√£e", alleles: [6, 9], color: "#ec4899" },    // Rosa
                    { name: "Filho", alleles: [9, 9.3], color: "#10b981" }, // Verde
                    { name: "Suposto Pai", alleles: [7, 9.3], color: "#3b82f6" } // Azul
                ],
                conclusion: "N√£o Exclus√£o de Paternidade",
                explanation: "O filho recebeu o alelo 9 da m√£e. O alelo 9.3 √© obrigatoriamente paterno. O Suposto Pai possui o 9.3."
            }
        ];

        // --- COMPONENTES GR√ÅFICOS ---

        // Um √∫nico gr√°fico para um √∫nico perfil (Eixo separado)
        const SingleProfileGraph = ({ profile, marker }) => {
            const mapAlleleToX = (allele) => {
                // L√≥gica simples de mapeamento para visualiza√ß√£o
                // Alelos menores √† esquerda, maiores √† direita
                return 50 + (allele * 35); 
            };

            return (
                <div className="mb-4">
                    <div className="flex items-center mb-1 text-sm font-bold">
                        <span className="mr-2 text-lg">üß¨</span> 
                        <span style={{color: profile.color}}>{profile.name}</span>
                    </div>
                    <div className="relative w-full h-32 bg-white border border-slate-300 rounded shadow-sm">
                        <svg viewBox="0 0 800 150" className="w-full h-full">
                            {/* Eixos e Grid */}
                            <line x1="40" y1="130" x2="780" y2="130" stroke="#cbd5e1" strokeWidth="2" /> {/* Eixo X */}
                            <line x1="40" y1="10" x2="40" y2="130" stroke="#cbd5e1" strokeWidth="2" />   {/* Eixo Y */}
                            <text x="15" y="70" className="text-[10px] fill-gray-400" transform="rotate(-90 15,70)">RFU</text>
                            
                            {/* Grid Lines verticais para refer√™ncia */}
                            {[5, 10, 15, 20].map(tick => (
                                <line key={tick} x1={mapAlleleToX(tick)} y1="10" x2={mapAlleleToX(tick)} y2="130" stroke="#f1f5f9" strokeDasharray="4" />
                            ))}

                            {/* Picos dos Alelos */}
                            {profile.alleles.map((allele, i) => {
                                const xPos = mapAlleleToX(allele);
                                return (
                                    <g key={i} transform={`translate(${xPos}, 0)`}>
                                        {/* Desenho do Pico */}
                                        <path 
                                            d="M -15 130 Q 0 10 15 130" 
                                            fill={profile.color} 
                                            opacity="0.5" 
                                            stroke={profile.color} 
                                            strokeWidth="2" 
                                        />
                                        {/* R√≥tulo do Alelo (N√∫mero) */}
                                        <text x="0" y="145" textAnchor="middle" className="text-xs font-bold fill-slate-600 font-mono">
                                            {allele}
                                        </text>
                                        {/* Label flutuante de altura (RFU simulado) */}
                                        <text x="0" y="30" textAnchor="middle" className="text-[9px] fill-gray-400">
                                            {Math.floor(Math.random() * 1000) + 2000}
                                        </text>
                                    </g>
                                );
                            })}
                        </svg>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        function ForensicLabSimulator() {
            const [selectedScenario, setSelectedScenario] = useState(SCENARIOS[0]);
            const [stage, setStage] = useState('intro'); 
            const [pcrProgress, setPcrProgress] = useState(0);
            const [pcrCycle, setPcrCycle] = useState(0);
            const [temperature, setTemperature] = useState(25);
            const [pcrActive, setPcrActive] = useState(false);
            const [dnaCopies, setDnaCopies] = useState(1);
            
            // L√≥gica do Termociclador
            useEffect(() => {
                let interval;
                if (pcrActive && pcrCycle < 30) {
                    interval = setInterval(() => {
                        setPcrProgress((prev) => {
                            if (prev >= 100) {
                                setPcrCycle(c => c + 1);
                                setDnaCopies(d => d * 2); 
                                return 0;
                            }
                            return prev + 2; // Velocidade da simula√ß√£o
                        });
                    }, 50);
                } else if (pcrCycle >= 30) {
                    setPcrActive(false);
                    setPcrProgress(100);
                }
                return () => clearInterval(interval);
            }, [pcrActive, pcrCycle]);

            // Controle de Temperatura Visual
            useEffect(() => {
                if (!pcrActive && pcrCycle !== 30) return;
                if (pcrProgress < 30) setTemperature(95); 
                else if (pcrProgress < 60) setTemperature(55); 
                else setTemperature(72); 
            }, [pcrProgress, pcrActive, pcrCycle]);

            const startPCR = () => {
                setPcrCycle(0);
                setPcrProgress(0);
                setDnaCopies(1);
                setPcrActive(true);
            };

            const skipPCR = () => {
                setPcrActive(false);
                setPcrCycle(30);
                setPcrProgress(100);
                setDnaCopies(1073741824); // 2^30
                setTemperature(4); // Temperatura de estocagem (hold)
            };

            const resetLab = () => {
                setStage('intro');
                setPcrCycle(0);
                setPcrProgress(0);
                setDnaCopies(1);
                setPcrActive(false);
                setTemperature(25);
            };

            return (
                <div className="min-h-screen flex flex-col font-sans text-slate-800">
                    
                    {/* HEADER */}
                    <header className="bg-slate-900 text-white p-4 shadow-lg sticky top-0 z-50">
                        <div className="max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-3">
                                <div className="text-4xl">üß¨</div>
                                <div>
                                    <h1 className="text-xl font-bold tracking-tight">Simulador Forense</h1>
                                    <p className="text-xs text-blue-300">M√≥dulo Educacional: PCR & Eletroforese</p>
                                </div>
                            </div>
                            <div className="flex bg-slate-800 rounded-full p-1">
                                {['intro', 'pcr', 'electrophoresis', 'analysis'].map((s, idx) => (
                                    <div 
                                        key={s}
                                        className={`px-4 py-1 rounded-full text-xs font-bold transition-colors ${stage === s ? 'bg-blue-500 text-white' : 'text-slate-400'}`}
                                    >
                                        {idx + 1}. {s === 'intro' ? 'Caso' : s === 'pcr' ? 'PCR' : s === 'electrophoresis' ? 'Eletroforese' : 'An√°lise'}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </header>

                    <main className="flex-grow max-w-5xl mx-auto w-full p-4 md:p-8">
                        
                        {/* EST√ÅGIO 1: SELE√á√ÉO DO CASO */}
                        {stage === 'intro' && (
                            <div className="animate-fade-in space-y-6">
                                <div className="bg-white p-6 rounded-xl shadow border border-slate-200">
                                    <h2 className="text-2xl font-bold mb-6 flex items-center">
                                        üìÇ Selecione um Caso Criminal ou Civil
                                    </h2>
                                    <div className="grid md:grid-cols-3 gap-4">
                                        {SCENARIOS.map((scenario) => (
                                            <button
                                                key={scenario.id}
                                                onClick={() => setSelectedScenario(scenario)}
                                                className={`p-5 rounded-xl border-2 text-left transition-all hover:scale-105 ${
                                                selectedScenario.id === scenario.id 
                                                ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-200' 
                                                : 'border-slate-200 hover:border-blue-300 hover:bg-white bg-slate-50'
                                                }`}
                                            >
                                                <div className="mb-3">
                                                    <span className={`text-xs font-bold uppercase px-2 py-1 rounded ${scenario.type === 'crime' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>
                                                        {scenario.type === 'crime' ? '‚öñÔ∏è Criminal' : 'üë™ Civil'}
                                                    </span>
                                                </div>
                                                <h3 className="font-bold text-lg mb-1">{scenario.title}</h3>
                                                <p className="text-sm text-slate-500">{scenario.description}</p>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="flex justify-end">
                                    <button 
                                        onClick={() => setStage('pcr')}
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-bold shadow-lg transition flex items-center gap-2 text-lg"
                                    >
                                        Ir para Laborat√≥rio ‚ñ∂Ô∏è
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* EST√ÅGIO 2: PCR */}
                        {stage === 'pcr' && (
                            <div className="animate-fade-in space-y-6">
                                <div className="bg-white p-6 rounded-xl shadow border border-slate-200">
                                    <div className="flex justify-between items-center mb-6 border-b pb-4">
                                        <div>
                                            <h2 className="text-2xl font-bold flex items-center gap-2">
                                                üå°Ô∏è Termociclador
                                            </h2>
                                            <p className="text-slate-500 text-sm">Amplifica√ß√£o de DNA via Rea√ß√£o em Cadeia da Polimerase</p>
                                        </div>
                                        <div className="text-right bg-slate-100 p-2 rounded-lg border">
                                            <div className="text-3xl font-mono font-bold text-blue-600">{temperature}¬∞C</div>
                                            <div className="text-xs text-slate-500 uppercase font-bold">Temperatura</div>
                                        </div>
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-8">
                                        {/* Visualiza√ß√£o Gr√°fica do Tubo */}
                                        <div className="bg-slate-900 p-8 rounded-lg h-64 flex flex-col items-center justify-center relative overflow-hidden border-4 border-slate-300 shadow-inner">
                                            <div className={`absolute inset-0 flex items-center justify-center transition-opacity duration-1000 ${pcrActive ? 'opacity-30' : 'opacity-10'}`}>
                                                <span className="text-9xl select-none animate-pulse">üß¨</span>
                                            </div>
                                            
                                            <div className="z-10 text-center text-white">
                                                <div className="text-2xl font-bold mb-2">
                                                    {pcrCycle === 30 ? "Amplifica√ß√£o Conclu√≠da" :
                                                     pcrProgress < 30 ? "1. Desnatura√ß√£o" :
                                                     pcrProgress < 60 ? "2. Anelamento" : 
                                                     "3. Extens√£o"}
                                                </div>
                                                <p className="text-sm text-slate-300 h-10 px-4">
                                                    {pcrCycle === 30 ? "Amostras prontas para eletroforese." :
                                                     pcrProgress < 30 ? "Quebra das pontes de hidrog√™nio (95¬∞C)." :
                                                     pcrProgress < 60 ? "Primers se ligam ao alvo (55¬∞C)." : 
                                                     "Taq Polimerase sintetiza nova fita (72¬∞C)."}
                                                </p>
                                            </div>

                                            {/* Barra de progresso do ciclo atual */}
                                            {pcrActive && (
                                                <div className="absolute bottom-0 left-0 h-2 bg-green-500 transition-all duration-100" style={{width: `${pcrProgress}%`}}></div>
                                            )}
                                        </div>

                                        {/* Controles e Estat√≠sticas */}
                                        <div className="flex flex-col justify-between">
                                            <div className="space-y-4">
                                                <div className="bg-blue-50 p-4 rounded border border-blue-100">
                                                    <div className="flex justify-between mb-2 text-sm font-bold text-blue-800">
                                                        <span>Ciclos (N):</span>
                                                        <span className="font-mono text-lg">{pcrCycle} / 30</span>
                                                    </div>
                                                    <div className="w-full bg-blue-200 rounded-full h-3">
                                                        <div className="bg-blue-600 h-3 rounded-full transition-all duration-300" style={{ width: `${(pcrCycle/30)*100}%` }}></div>
                                                    </div>
                                                </div>

                                                <div className="bg-slate-50 p-4 rounded border border-slate-200">
                                                    <div className="flex justify-between mb-1">
                                                        <span className="text-sm font-bold text-slate-600">C√≥pias Estimadas (2‚Åø):</span>
                                                    </div>
                                                    <div className="text-xl font-mono text-slate-800 truncate" title={dnaCopies.toLocaleString()}>
                                                        {dnaCopies > 1000000 ? "Milh√µes..." : dnaCopies.toLocaleString()}
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="space-y-3 mt-4">
                                                {!pcrActive && pcrCycle === 0 && (
                                                    <button onClick={startPCR} className="w-full py-4 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition shadow-md flex justify-center items-center gap-2">
                                                        <span>üî•</span> Iniciar Ciclos T√©rmicos
                                                    </button>
                                                )}

                                                {pcrActive && (
                                                    <button onClick={skipPCR} className="w-full py-3 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 transition shadow-sm flex justify-center items-center gap-2">
                                                        <span>‚è©</span> Pular Simula√ß√£o (Finalizar)
                                                    </button>
                                                )}
                                                
                                                {pcrCycle === 30 && (
                                                    <button onClick={() => setStage('electrophoresis')} className="w-full py-4 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition animate-pulse shadow-lg flex justify-center items-center gap-2">
                                                        Ir para Eletroforese Capilar ‚û°Ô∏è
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* EST√ÅGIO 3: ELETROFORESE CAPILAR */}
                        {stage === 'electrophoresis' && (
                            <div className="animate-fade-in space-y-6">
                                <div className="bg-white p-6 rounded-xl shadow border border-slate-200">
                                    <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                                        ‚ö° Eletroforese Capilar
                                    </h2>
                                    <p className="text-slate-600 mb-6">
                                        O DNA migra do polo negativo para o positivo. O Laser detecta os fragmentos quando eles passam pela janela de leitura. 
                                        <br/><small className="text-slate-500">Fragmentos menores correm mais r√°pido.</small>
                                    </p>

                                    {/* Representa√ß√£o Visual do Capilar */}
                                    <div className="relative h-56 bg-slate-900 rounded-lg overflow-hidden border-4 border-slate-700 shadow-2xl mb-6">
                                        
                                        {/* Marca√ß√µes de Polo */}
                                        <div className="absolute top-2 left-4 text-white/50 font-bold text-sm">‚ûñ C√°todo (In√≠cio)</div>
                                        <div className="absolute top-2 right-4 text-white/50 font-bold text-sm">‚ûï √Çnodo (Fim)</div>

                                        {/* O Laser */}
                                        <div className="absolute top-0 bottom-0 left-[75%] w-1 bg-red-500 z-20 shadow-[0_0_15px_rgba(239,68,68,0.8)]"></div>
                                        <div className="absolute bottom-2 left-[75%] transform -translate-x-1/2 text-red-500 text-xs font-bold tracking-widest z-20 bg-black px-2 rounded">LASER</div>

                                        {/* Fragmentos de DNA animados */}
                                        {/* Simula√ß√£o: V√°rios pontos coloridos correndo para a direita */}
                                        
                                        {/* Fragmentos Pequenos (R√°pidos) */}
                                        <div className="fragment-run w-3 h-3 bg-blue-400 text-blue-400" style={{top: '30%', animation: 'runToLaser 1.5s linear infinite'}}></div>
                                        <div className="fragment-run w-3 h-3 bg-blue-400 text-blue-400" style={{top: '30%', animation: 'runToLaser 1.5s linear infinite', animationDelay: '0.7s'}}></div>
                                        
                                        {/* Fragmentos M√©dios */}
                                        <div className="fragment-run w-4 h-4 bg-green-400 text-green-400" style={{top: '50%', animation: 'runToLaser 2.5s linear infinite'}}></div>
                                        
                                        {/* Fragmentos Grandes (Lentos) */}
                                        <div className="fragment-run w-5 h-5 bg-yellow-400 text-yellow-400" style={{top: '70%', animation: 'runToLaser 4s linear infinite', animationDelay: '1s'}}></div>

                                        {/* Efeito de brilho ao passar no laser */}
                                        <div className="absolute top-[28%] left-[75%] w-4 h-4 bg-white rounded-full opacity-0 animate-pulse z-30" style={{animationDuration: '0.2s'}}></div>
                                    </div>

                                    <div className="flex justify-end">
                                        <button 
                                            onClick={() => setStage('analysis')}
                                            className="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-lg font-bold shadow-lg transition flex items-center gap-2 text-lg"
                                        >
                                            Gerar Eletroferogramas üìà
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* EST√ÅGIO 4: AN√ÅLISE */}
                        {stage === 'analysis' && (
                            <div className="animate-fade-in space-y-6">
                                <div className="bg-white p-6 rounded-xl shadow border border-slate-200">
                                    <div className="border-b border-slate-200 pb-4 mb-6">
                                        <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-2">
                                            üî¨ Resultados da An√°lise
                                        </h2>
                                        <p className="text-slate-500">Marcador Analisado: <strong className="text-black bg-yellow-200 px-2 rounded">{selectedScenario.marker}</strong></p>
                                    </div>
                                    
                                    {/* √ÅREA DOS GR√ÅFICOS SEPARADOS */}
                                    <div className="bg-slate-50 p-6 rounded-xl border border-slate-200 mb-8">
                                        <h3 className="text-sm font-bold text-slate-500 uppercase mb-4 tracking-wider">Eletroferogramas (Visualiza√ß√£o em Eixos Distintos)</h3>
                                        
                                        {selectedScenario.profiles.map((profile, idx) => (
                                            <SingleProfileGraph 
                                                key={idx} 
                                                profile={profile} 
                                                marker={selectedScenario.marker}
                                            />
                                        ))}
                                    </div>

                                    {/* CONCLUS√ÉO E EXPLICA√á√ÉO */}
                                    <div className="grid md:grid-cols-2 gap-6">
                                        {/* Card de Dados T√©cnicos */}
                                        <div className="bg-white p-5 rounded-lg border border-slate-200 shadow-sm">
                                            <h3 className="font-bold text-lg mb-3 flex items-center gap-2">
                                                üìä Dados Genotipados
                                            </h3>
                                            <div className="space-y-3">
                                                {selectedScenario.profiles.map((p, idx) => (
                                                    <div key={idx} className="flex justify-between border-b border-slate-100 pb-2 last:border-0">
                                                        <span className="font-medium text-slate-600">{p.name}</span>
                                                        <span className="font-mono font-bold bg-slate-100 px-2 rounded text-slate-800">
                                                            {p.alleles.join(', ')}
                                                        </span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Card de Conclus√£o */}
                                        <div className={`p-5 rounded-lg border-l-4 shadow-sm ${selectedScenario.conclusion.includes('Exclus√£o') && !selectedScenario.conclusion.includes('N√£o') ? 'bg-red-50 border-red-500' : 'bg-green-50 border-green-500'}`}>
                                            <h3 className="font-bold text-lg mb-2 flex items-center gap-2">
                                                {selectedScenario.conclusion.includes('Exclus√£o') && !selectedScenario.conclusion.includes('N√£o') ? 'üö´' : '‚úÖ'} 
                                                Laudo Pericial
                                            </h3>
                                            <p className="font-bold text-xl mb-3 text-slate-900">{selectedScenario.conclusion}</p>
                                            <p className="text-sm text-slate-700 leading-relaxed italic">
                                                "{selectedScenario.explanation}"
                                            </p>
                                        </div>
                                    </div>

                                    <div className="mt-8 pt-6 border-t border-slate-200 flex justify-center">
                                        <button onClick={resetLab} className="flex items-center px-6 py-3 bg-slate-800 text-white hover:bg-slate-700 rounded-lg transition shadow">
                                            üîÑ Analisar Novo Caso
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    
                    <footer className="p-6 text-center text-slate-400 text-xs">
                        &copy; 2023 Simulador Educacional de Gen√©tica Forense. Apenas para fins did√°ticos.
                    </footer>
                </div>
            );
        }

        // Renderiza√ß√£o
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ForensicLabSimulator />);
    </script>
</body>
</html>
